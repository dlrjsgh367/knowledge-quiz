# Knowledge Quiz 백엔드 기능 정의서

## 문서 정보
- **작성일**: 2026-01-08
- **버전**: v1.0
- **작성자**: Claude
- **프로젝트**: Knowledge Quiz (상식 퀴즈 앱) - Backend API

---

## 1. 프로젝트 개요

### 1.1 기술 스택
- **Framework**: Spring Boot 3.5.9
- **Language**: Java 17
- **Build Tool**: Gradle 8.x
- **Database**: MySQL 8.0
- **ORM**: Spring Data JPA (Hibernate)
- **Additional Libraries**:
  - Lombok: 보일러플레이트 코드 제거
  - Spring Boot DevTools: 개발 생산성 향상
  - MySQL Connector: 데이터베이스 연결
  - Spring Validation: 입력 검증
  - Spring Security: 인증/인가 (향후 추가)
  - JWT: 토큰 기반 인증 (향후 추가)

### 1.2 서버 설정
- **서버 포트**: 8081
- **데이터베이스**: home_db
- **JPA 설정**:
  - `ddl-auto`: update
  - `show-sql`: true
  - Dialect: MySQLDialect

### 1.3 프로젝트 구조
```
backend/quiz/
├── src/
│   ├── main/
│   │   ├── java/com/geonho/quiz/
│   │   │   ├── QuizApplication.java          # Main 클래스
│   │   │   ├── domain/                        # 도메인 계층
│   │   │   │   ├── member/                    # 회원 도메인
│   │   │   │   │   ├── entity/
│   │   │   │   │   │   └── Member.java
│   │   │   │   │   ├── repository/
│   │   │   │   │   │   └── MemberRepository.java
│   │   │   │   │   ├── service/
│   │   │   │   │   │   └── MemberService.java
│   │   │   │   │   ├── api/
│   │   │   │   │   │   └── MemberController.java
│   │   │   │   │   └── dto/
│   │   │   │   │       ├── MemberRequest.java
│   │   │   │   │       └── MemberResponse.java
│   │   │   │   ├── quiz/                      # 퀴즈 도메인
│   │   │   │   │   ├── entity/
│   │   │   │   │   │   ├── Quiz.java
│   │   │   │   │   │   ├── Question.java
│   │   │   │   │   │   ├── Option.java
│   │   │   │   │   │   └── Category.java
│   │   │   │   │   ├── repository/
│   │   │   │   │   ├── service/
│   │   │   │   │   ├── api/
│   │   │   │   │   └── dto/
│   │   │   │   └── attempt/                   # 퀴즈 시도/기록 도메인
│   │   │   │       ├── entity/
│   │   │   │       │   ├── QuizAttempt.java
│   │   │   │       │   └── Answer.java
│   │   │   │       ├── repository/
│   │   │   │       ├── service/
│   │   │   │       ├── api/
│   │   │   │       └── dto/
│   │   │   ├── global/                        # 전역 설정
│   │   │   │   ├── config/
│   │   │   │   │   ├── SecurityConfig.java
│   │   │   │   │   ├── JpaConfig.java
│   │   │   │   │   └── WebConfig.java
│   │   │   │   ├── exception/
│   │   │   │   │   ├── GlobalExceptionHandler.java
│   │   │   │   │   ├── BusinessException.java
│   │   │   │   │   └── ErrorCode.java
│   │   │   │   ├── response/
│   │   │   │   │   ├── ApiResponse.java
│   │   │   │   │   └── PageResponse.java
│   │   │   │   └── util/
│   │   │   │       ├── JwtUtil.java
│   │   │   │       └── SecurityUtil.java
│   │   │   └── infrastructure/                # 인프라 계층
│   │   │       └── init/
│   │   │           └── DataInitializer.java
│   │   └── resources/
│   │       ├── application.yaml               # 메인 설정
│   │       ├── application-dev.yaml           # 개발 환경
│   │       ├── application-prod.yaml          # 운영 환경
│   │       └── data.sql                       # 초기 데이터
│   └── test/
│       └── java/com/geonho/quiz/
│           ├── QuizApplicationTests.java
│           ├── domain/
│           │   ├── member/
│           │   ├── quiz/
│           │   └── attempt/
│           └── integration/
├── build.gradle
├── settings.gradle
├── docker-compose.yml
└── README.md
```

---

## 2. 데이터베이스 설계

### 2.1 ERD 개념도
```
┌─────────────┐       ┌──────────────┐       ┌─────────────┐
│   Member    │       │ QuizAttempt  │       │    Quiz     │
├─────────────┤       ├──────────────┤       ├─────────────┤
│ id (PK)     │──1:N──│ id (PK)      │──N:1──│ id (PK)     │
│ email       │       │ member_id FK │       │ title       │
│ password    │       │ quiz_id FK   │       │ category_id │
│ username    │       │ score        │       │ difficulty  │
│ created_at  │       │ time_taken   │       │ created_at  │
│ updated_at  │       │ completed_at │       └─────────────┘
└─────────────┘       │ created_at   │              │
                      └──────────────┘              │ 1:N
                             │ 1:N                  ▼
                             ▼                 ┌─────────────┐
                      ┌──────────────┐         │  Question   │
                      │    Answer    │         ├─────────────┤
                      ├──────────────┤         │ id (PK)     │
                      │ id (PK)      │         │ quiz_id FK  │
                      │ attempt_id FK│         │ question    │
                      │ question_id  │         │ order_num   │
                      │ selected_opt │         │ created_at  │
                      │ is_correct   │         └─────────────┘
                      └──────────────┘                │ 1:N
                                                      ▼
                                               ┌─────────────┐
                                               │   Option    │
                                               ├─────────────┤
                                               │ id (PK)     │
                                               │ question_id │
                                               │ option_text │
                                               │ order_num   │
                                               │ is_correct  │
                                               └─────────────┘

┌──────────────┐
│   Category   │
├──────────────┤
│ id (PK)      │
│ name         │
│ code         │
│ icon         │
│ color        │
└──────────────┘
```

### 2.2 테이블 정의

#### 2.2.1 Member (회원)
```sql
CREATE TABLE member (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    username VARCHAR(100) NOT NULL,
    role VARCHAR(20) DEFAULT 'USER',
    status VARCHAR(20) DEFAULT 'ACTIVE',
    created_at DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    updated_at DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),
    INDEX idx_email (email),
    INDEX idx_username (username)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**필드 설명:**
- `id`: 회원 고유 ID (PK)
- `email`: 이메일 (로그인 ID, UNIQUE)
- `password`: 암호화된 비밀번호 (BCrypt)
- `username`: 사용자 닉네임
- `role`: 권한 (USER, ADMIN)
- `status`: 계정 상태 (ACTIVE, INACTIVE, BANNED)
- `created_at`: 가입일시
- `updated_at`: 수정일시

#### 2.2.2 Category (카테고리)
```sql
CREATE TABLE category (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) NOT NULL UNIQUE,
    icon VARCHAR(50),
    color VARCHAR(50),
    display_order INT DEFAULT 0,
    created_at DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    INDEX idx_code (code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**초기 데이터:**
```sql
INSERT INTO category (name, code, icon, color, display_order) VALUES
('역사', 'history', 'BookOpen', 'amber', 1),
('과학', 'science', 'Beaker', 'blue', 2),
('지리', 'geography', 'Globe', 'green', 3),
('문화', 'culture', 'Music', 'purple', 4),
('엔터테인먼트', 'entertainment', 'Film', 'pink', 5),
('기술', 'technology', 'Code', 'indigo', 6),
('일반상식', 'general', 'Brain', 'teal', 7);
```

#### 2.2.3 Quiz (퀴즈)
```sql
CREATE TABLE quiz (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    category_id BIGINT NOT NULL,
    difficulty VARCHAR(20) NOT NULL,
    estimated_time INT COMMENT '예상 소요 시간(초)',
    is_published BOOLEAN DEFAULT false,
    created_by BIGINT,
    created_at DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    updated_at DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),
    FOREIGN KEY (category_id) REFERENCES category(id),
    FOREIGN KEY (created_by) REFERENCES member(id),
    INDEX idx_category (category_id),
    INDEX idx_difficulty (difficulty),
    INDEX idx_published (is_published)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**필드 설명:**
- `difficulty`: EASY, MEDIUM, HARD
- `is_published`: 공개 여부
- `created_by`: 작성자 (관리자)

#### 2.2.4 Question (문제)
```sql
CREATE TABLE question (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    quiz_id BIGINT NOT NULL,
    question_text TEXT NOT NULL,
    order_num INT NOT NULL,
    explanation TEXT COMMENT '해설',
    created_at DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    updated_at DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),
    FOREIGN KEY (quiz_id) REFERENCES quiz(id) ON DELETE CASCADE,
    INDEX idx_quiz (quiz_id, order_num)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### 2.2.5 Option (선택지)
```sql
CREATE TABLE question_option (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    question_id BIGINT NOT NULL,
    option_text VARCHAR(500) NOT NULL,
    order_num INT NOT NULL,
    is_correct BOOLEAN NOT NULL DEFAULT false,
    created_at DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    FOREIGN KEY (question_id) REFERENCES question(id) ON DELETE CASCADE,
    INDEX idx_question (question_id, order_num)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### 2.2.6 QuizAttempt (퀴즈 시도)
```sql
CREATE TABLE quiz_attempt (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    member_id BIGINT NOT NULL,
    quiz_id BIGINT NOT NULL,
    score INT NOT NULL,
    total_questions INT NOT NULL,
    time_taken INT NOT NULL COMMENT '소요 시간(초)',
    completed_at DATETIME(6) NOT NULL,
    created_at DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    FOREIGN KEY (member_id) REFERENCES member(id),
    FOREIGN KEY (quiz_id) REFERENCES quiz(id),
    INDEX idx_member (member_id, completed_at DESC),
    INDEX idx_quiz (quiz_id),
    INDEX idx_completed (completed_at DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### 2.2.7 Answer (답안)
```sql
CREATE TABLE answer (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    attempt_id BIGINT NOT NULL,
    question_id BIGINT NOT NULL,
    selected_option_id BIGINT,
    is_correct BOOLEAN NOT NULL,
    created_at DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    FOREIGN KEY (attempt_id) REFERENCES quiz_attempt(id) ON DELETE CASCADE,
    FOREIGN KEY (question_id) REFERENCES question(id),
    FOREIGN KEY (selected_option_id) REFERENCES question_option(id),
    INDEX idx_attempt (attempt_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

## 3. Entity 설계

### 3.1 Member (회원)
```java
@Entity
@Table(name = "member")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EntityListeners(AuditingEntityListener.class)
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true, length = 255)
    private String email;

    @Column(nullable = false, length = 255)
    private String password;

    @Column(nullable = false, length = 100)
    private String username;

    @Enumerated(EnumType.STRING)
    @Column(length = 20)
    private Role role = Role.USER;

    @Enumerated(EnumType.STRING)
    @Column(length = 20)
    private MemberStatus status = MemberStatus.ACTIVE;

    @CreatedDate
    @Column(nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @LastModifiedDate
    @Column(nullable = false)
    private LocalDateTime updatedAt;

    @OneToMany(mappedBy = "member", cascade = CascadeType.ALL)
    private List<QuizAttempt> attempts = new ArrayList<>();

    @Builder
    public Member(String email, String password, String username) {
        this.email = email;
        this.password = password;
        this.username = username;
    }

    // 비즈니스 메서드
    public void updateUsername(String username) {
        this.username = username;
    }

    public void changePassword(String newPassword) {
        this.password = newPassword;
    }
}
```

**Enum 정의:**
```java
public enum Role {
    USER, ADMIN
}

public enum MemberStatus {
    ACTIVE, INACTIVE, BANNED
}
```

### 3.2 Category (카테고리)
```java
@Entity
@Table(name = "category")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EntityListeners(AuditingEntityListener.class)
public class Category {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length = 100)
    private String name;

    @Column(nullable = false, unique = true, length = 50)
    private String code;

    @Column(length = 50)
    private String icon;

    @Column(length = 50)
    private String color;

    @Column(name = "display_order")
    private Integer displayOrder = 0;

    @CreatedDate
    @Column(nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @OneToMany(mappedBy = "category")
    private List<Quiz> quizzes = new ArrayList<>();
}
```

### 3.3 Quiz (퀴즈)
```java
@Entity
@Table(name = "quiz")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EntityListeners(AuditingEntityListener.class)
public class Quiz {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length = 255)
    private String title;

    @Column(columnDefinition = "TEXT")
    private String description;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "category_id", nullable = false)
    private Category category;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false, length = 20)
    private Difficulty difficulty;

    @Column(name = "estimated_time")
    private Integer estimatedTime;

    @Column(name = "is_published")
    private Boolean isPublished = false;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "created_by")
    private Member createdBy;

    @CreatedDate
    @Column(nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @LastModifiedDate
    @Column(nullable = false)
    private LocalDateTime updatedAt;

    @OneToMany(mappedBy = "quiz", cascade = CascadeType.ALL, orphanRemoval = true)
    @OrderBy("orderNum ASC")
    private List<Question> questions = new ArrayList<>();

    @Builder
    public Quiz(String title, String description, Category category,
                Difficulty difficulty, Integer estimatedTime) {
        this.title = title;
        this.description = description;
        this.category = category;
        this.difficulty = difficulty;
        this.estimatedTime = estimatedTime;
    }

    // 비즈니스 메서드
    public void publish() {
        this.isPublished = true;
    }

    public void unpublish() {
        this.isPublished = false;
    }

    public void addQuestion(Question question) {
        this.questions.add(question);
        question.setQuiz(this);
    }
}
```

**Enum 정의:**
```java
public enum Difficulty {
    EASY("초급"),
    MEDIUM("중급"),
    HARD("고급");

    private final String description;

    Difficulty(String description) {
        this.description = description;
    }
}
```

### 3.4 Question (문제)
```java
@Entity
@Table(name = "question")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EntityListeners(AuditingEntityListener.class)
public class Question {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "quiz_id", nullable = false)
    private Quiz quiz;

    @Column(name = "question_text", nullable = false, columnDefinition = "TEXT")
    private String questionText;

    @Column(name = "order_num", nullable = false)
    private Integer orderNum;

    @Column(columnDefinition = "TEXT")
    private String explanation;

    @CreatedDate
    @Column(nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @LastModifiedDate
    @Column(nullable = false)
    private LocalDateTime updatedAt;

    @OneToMany(mappedBy = "question", cascade = CascadeType.ALL, orphanRemoval = true)
    @OrderBy("orderNum ASC")
    private List<QuestionOption> options = new ArrayList<>();

    @Builder
    public Question(Quiz quiz, String questionText, Integer orderNum, String explanation) {
        this.quiz = quiz;
        this.questionText = questionText;
        this.orderNum = orderNum;
        this.explanation = explanation;
    }

    protected void setQuiz(Quiz quiz) {
        this.quiz = quiz;
    }

    public void addOption(QuestionOption option) {
        this.options.add(option);
        option.setQuestion(this);
    }

    public QuestionOption getCorrectOption() {
        return options.stream()
            .filter(QuestionOption::getIsCorrect)
            .findFirst()
            .orElseThrow(() -> new IllegalStateException("정답이 설정되지 않았습니다."));
    }
}
```

### 3.5 QuestionOption (선택지)
```java
@Entity
@Table(name = "question_option")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EntityListeners(AuditingEntityListener.class)
public class QuestionOption {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "question_id", nullable = false)
    private Question question;

    @Column(name = "option_text", nullable = false, length = 500)
    private String optionText;

    @Column(name = "order_num", nullable = false)
    private Integer orderNum;

    @Column(name = "is_correct", nullable = false)
    private Boolean isCorrect = false;

    @CreatedDate
    @Column(nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @Builder
    public QuestionOption(Question question, String optionText,
                          Integer orderNum, Boolean isCorrect) {
        this.question = question;
        this.optionText = optionText;
        this.orderNum = orderNum;
        this.isCorrect = isCorrect;
    }

    protected void setQuestion(Question question) {
        this.question = question;
    }
}
```

### 3.6 QuizAttempt (퀴즈 시도)
```java
@Entity
@Table(name = "quiz_attempt")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EntityListeners(AuditingEntityListener.class)
public class QuizAttempt {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "member_id", nullable = false)
    private Member member;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "quiz_id", nullable = false)
    private Quiz quiz;

    @Column(nullable = false)
    private Integer score;

    @Column(name = "total_questions", nullable = false)
    private Integer totalQuestions;

    @Column(name = "time_taken", nullable = false)
    private Integer timeTaken;

    @Column(name = "completed_at", nullable = false)
    private LocalDateTime completedAt;

    @CreatedDate
    @Column(nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @OneToMany(mappedBy = "attempt", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Answer> answers = new ArrayList<>();

    @Builder
    public QuizAttempt(Member member, Quiz quiz, Integer score,
                       Integer totalQuestions, Integer timeTaken,
                       LocalDateTime completedAt) {
        this.member = member;
        this.quiz = quiz;
        this.score = score;
        this.totalQuestions = totalQuestions;
        this.timeTaken = timeTaken;
        this.completedAt = completedAt;
    }

    public void addAnswer(Answer answer) {
        this.answers.add(answer);
        answer.setAttempt(this);
    }

    public double getPercentage() {
        return (double) score / totalQuestions * 100;
    }
}
```

### 3.7 Answer (답안)
```java
@Entity
@Table(name = "answer")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EntityListeners(AuditingEntityListener.class)
public class Answer {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "attempt_id", nullable = false)
    private QuizAttempt attempt;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "question_id", nullable = false)
    private Question question;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "selected_option_id")
    private QuestionOption selectedOption;

    @Column(name = "is_correct", nullable = false)
    private Boolean isCorrect;

    @CreatedDate
    @Column(nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @Builder
    public Answer(QuizAttempt attempt, Question question,
                  QuestionOption selectedOption, Boolean isCorrect) {
        this.attempt = attempt;
        this.question = question;
        this.selectedOption = selectedOption;
        this.isCorrect = isCorrect;
    }

    protected void setAttempt(QuizAttempt attempt) {
        this.attempt = attempt;
    }
}
```

---

## 4. API 설계

### 4.1 공통 응답 포맷

#### 성공 응답
```json
{
  "success": true,
  "data": { ... },
  "message": "성공 메시지"
}
```

#### 에러 응답
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "에러 메시지",
    "details": { ... }
  },
  "timestamp": "2026-01-08T10:30:00"
}
```

#### 페이징 응답
```json
{
  "success": true,
  "data": {
    "content": [ ... ],
    "page": 0,
    "size": 20,
    "totalElements": 100,
    "totalPages": 5,
    "first": true,
    "last": false
  }
}
```

### 4.2 인증 API

#### 4.2.1 회원가입
```
POST /api/auth/signup
Content-Type: application/json

Request:
{
  "email": "user@example.com",
  "password": "password123!",
  "username": "홍길동"
}

Response (201):
{
  "success": true,
  "data": {
    "id": 1,
    "email": "user@example.com",
    "username": "홍길동",
    "role": "USER",
    "createdAt": "2026-01-08T10:30:00"
  },
  "message": "회원가입이 완료되었습니다."
}
```

**검증 규칙:**
- email: 이메일 형식, 중복 불가
- password: 6자 이상, 영문+숫자 조합
- username: 2-20자, 중복 가능

#### 4.2.2 로그인
```
POST /api/auth/login
Content-Type: application/json

Request:
{
  "email": "user@example.com",
  "password": "password123!"
}

Response (200):
{
  "success": true,
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 3600,
    "user": {
      "id": 1,
      "email": "user@example.com",
      "username": "홍길동",
      "role": "USER"
    }
  },
  "message": "로그인 성공"
}
```

#### 4.2.3 로그아웃
```
POST /api/auth/logout
Authorization: Bearer {accessToken}

Response (200):
{
  "success": true,
  "message": "로그아웃되었습니다."
}
```

#### 4.2.4 토큰 갱신
```
POST /api/auth/refresh
Content-Type: application/json

Request:
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}

Response (200):
{
  "success": true,
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 3600
  }
}
```

#### 4.2.5 현재 사용자 정보
```
GET /api/auth/me
Authorization: Bearer {accessToken}

Response (200):
{
  "success": true,
  "data": {
    "id": 1,
    "email": "user@example.com",
    "username": "홍길동",
    "role": "USER",
    "createdAt": "2026-01-08T10:30:00"
  }
}
```

### 4.3 카테고리 API

#### 4.3.1 카테고리 목록 조회
```
GET /api/categories

Response (200):
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "역사",
      "code": "history",
      "icon": "BookOpen",
      "color": "amber",
      "quizCount": 15
    },
    {
      "id": 2,
      "name": "과학",
      "code": "science",
      "icon": "Beaker",
      "color": "blue",
      "quizCount": 12
    }
  ]
}
```

### 4.4 퀴즈 API

#### 4.4.1 퀴즈 목록 조회
```
GET /api/quizzes?category={categoryCode}&difficulty={difficulty}&page=0&size=20
Authorization: Bearer {accessToken} (Optional)

Query Parameters:
- category: history, science, geography, etc. (optional)
- difficulty: EASY, MEDIUM, HARD (optional)
- page: 페이지 번호 (default: 0)
- size: 페이지 크기 (default: 20)

Response (200):
{
  "success": true,
  "data": {
    "content": [
      {
        "id": 1,
        "title": "한국사 기초",
        "description": "한국 역사의 기본을 다지는 퀴즈",
        "category": {
          "id": 1,
          "name": "역사",
          "code": "history"
        },
        "difficulty": "EASY",
        "questionCount": 5,
        "estimatedTime": 300,
        "createdAt": "2026-01-08T10:30:00"
      }
    ],
    "page": 0,
    "size": 20,
    "totalElements": 50,
    "totalPages": 3
  }
}
```

#### 4.4.2 퀴즈 상세 조회
```
GET /api/quizzes/{quizId}
Authorization: Bearer {accessToken}

Response (200):
{
  "success": true,
  "data": {
    "id": 1,
    "title": "한국사 기초",
    "description": "한국 역사의 기본을 다지는 퀴즈",
    "category": {
      "id": 1,
      "name": "역사",
      "code": "history"
    },
    "difficulty": "EASY",
    "estimatedTime": 300,
    "questions": [
      {
        "id": 1,
        "questionText": "고려를 건국한 인물은?",
        "orderNum": 1,
        "options": [
          {
            "id": 1,
            "optionText": "왕건",
            "orderNum": 1
          },
          {
            "id": 2,
            "optionText": "이성계",
            "orderNum": 2
          },
          {
            "id": 3,
            "optionText": "박혁거세",
            "orderNum": 3
          },
          {
            "id": 4,
            "optionText": "주몽",
            "orderNum": 4
          }
        ]
      }
    ]
  }
}
```

**주의:** 정답 정보(`isCorrect`)는 포함하지 않음

#### 4.4.3 인기 퀴즈 조회
```
GET /api/quizzes/popular?limit=10

Response (200):
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "한국사 기초",
      "category": { ... },
      "difficulty": "EASY",
      "questionCount": 5,
      "attemptCount": 1523,
      "averageScore": 78.5
    }
  ]
}
```

#### 4.4.4 퀴즈 생성 (관리자)
```
POST /api/admin/quizzes
Authorization: Bearer {accessToken}
Content-Type: application/json

Request:
{
  "title": "한국사 기초",
  "description": "한국 역사의 기본을 다지는 퀴즈",
  "categoryId": 1,
  "difficulty": "EASY",
  "estimatedTime": 300,
  "questions": [
    {
      "questionText": "고려를 건국한 인물은?",
      "orderNum": 1,
      "explanation": "왕건은 918년 고려를 건국했습니다.",
      "options": [
        {
          "optionText": "왕건",
          "orderNum": 1,
          "isCorrect": true
        },
        {
          "optionText": "이성계",
          "orderNum": 2,
          "isCorrect": false
        }
      ]
    }
  ]
}

Response (201):
{
  "success": true,
  "data": {
    "id": 1,
    "title": "한국사 기초",
    ...
  },
  "message": "퀴즈가 생성되었습니다."
}
```

### 4.5 퀴즈 시도 API

#### 4.5.1 퀴즈 제출
```
POST /api/quiz-attempts
Authorization: Bearer {accessToken}
Content-Type: application/json

Request:
{
  "quizId": 1,
  "answers": [
    {
      "questionId": 1,
      "selectedOptionId": 1
    },
    {
      "questionId": 2,
      "selectedOptionId": 6
    }
  ],
  "timeTaken": 180
}

Response (201):
{
  "success": true,
  "data": {
    "id": 1,
    "quiz": {
      "id": 1,
      "title": "한국사 기초"
    },
    "score": 4,
    "totalQuestions": 5,
    "percentage": 80.0,
    "timeTaken": 180,
    "completedAt": "2026-01-08T10:45:00",
    "answers": [
      {
        "questionId": 1,
        "selectedOptionId": 1,
        "isCorrect": true,
        "correctOptionId": 1,
        "explanation": "왕건은 918년 고려를 건국했습니다."
      },
      {
        "questionId": 2,
        "selectedOptionId": 6,
        "isCorrect": false,
        "correctOptionId": 7,
        "explanation": "조선의 수도는 한양입니다."
      }
    ]
  },
  "message": "퀴즈가 제출되었습니다."
}
```

### 4.6 사용자 통계 API

#### 4.6.1 내 퀴즈 히스토리
```
GET /api/users/me/history?page=0&size=20
Authorization: Bearer {accessToken}

Response (200):
{
  "success": true,
  "data": {
    "content": [
      {
        "id": 1,
        "quiz": {
          "id": 1,
          "title": "한국사 기초",
          "category": {
            "name": "역사",
            "code": "history"
          }
        },
        "score": 4,
        "totalQuestions": 5,
        "percentage": 80.0,
        "timeTaken": 180,
        "completedAt": "2026-01-08T10:45:00"
      }
    ],
    "page": 0,
    "size": 20,
    "totalElements": 25,
    "totalPages": 2
  }
}
```

#### 4.6.2 내 전체 통계
```
GET /api/users/me/stats
Authorization: Bearer {accessToken}

Response (200):
{
  "success": true,
  "data": {
    "totalAttempts": 25,
    "totalQuestions": 125,
    "totalCorrect": 98,
    "averageScore": 78.4,
    "totalTimeTaken": 4500,
    "categoryStats": [
      {
        "category": {
          "id": 1,
          "name": "역사",
          "code": "history"
        },
        "attemptCount": 8,
        "totalQuestions": 40,
        "correctAnswers": 32,
        "percentage": 80.0
      }
    ],
    "recentAttempts": [
      {
        "quiz": { ... },
        "score": 4,
        "completedAt": "2026-01-08T10:45:00"
      }
    ]
  }
}
```

#### 4.6.3 퀴즈 시도 상세 조회
```
GET /api/quiz-attempts/{attemptId}
Authorization: Bearer {accessToken}

Response (200):
{
  "success": true,
  "data": {
    "id": 1,
    "quiz": {
      "id": 1,
      "title": "한국사 기초",
      "category": { ... }
    },
    "score": 4,
    "totalQuestions": 5,
    "percentage": 80.0,
    "timeTaken": 180,
    "completedAt": "2026-01-08T10:45:00",
    "answers": [
      {
        "question": {
          "id": 1,
          "questionText": "고려를 건국한 인물은?",
          "explanation": "왕건은 918년 고려를 건국했습니다."
        },
        "selectedOption": {
          "id": 1,
          "optionText": "왕건"
        },
        "correctOption": {
          "id": 1,
          "optionText": "왕건"
        },
        "isCorrect": true
      }
    ]
  }
}
```

### 4.7 리더보드 API (향후 구현)

#### 4.7.1 전체 리더보드
```
GET /api/leaderboard?period=weekly&page=0&size=50

Query Parameters:
- period: daily, weekly, monthly, all-time
- page, size

Response (200):
{
  "success": true,
  "data": {
    "period": "weekly",
    "rankings": [
      {
        "rank": 1,
        "user": {
          "id": 5,
          "username": "퀴즈왕"
        },
        "totalScore": 2850,
        "attemptCount": 30,
        "averageScore": 95.0
      }
    ]
  }
}
```

---

## 5. Service 계층 설계

### 5.1 MemberService
```java
@Service
@RequiredArgsConstructor
@Transactional(readOnly = true)
public class MemberService {

    private final MemberRepository memberRepository;
    private final PasswordEncoder passwordEncoder;

    @Transactional
    public MemberResponse signup(SignupRequest request) {
        // 이메일 중복 체크
        if (memberRepository.existsByEmail(request.getEmail())) {
            throw new BusinessException(ErrorCode.DUPLICATE_EMAIL);
        }

        // 비밀번호 암호화
        String encodedPassword = passwordEncoder.encode(request.getPassword());

        // 회원 생성
        Member member = Member.builder()
            .email(request.getEmail())
            .password(encodedPassword)
            .username(request.getUsername())
            .build();

        Member savedMember = memberRepository.save(member);
        return MemberResponse.from(savedMember);
    }

    public MemberResponse findById(Long memberId) {
        Member member = memberRepository.findById(memberId)
            .orElseThrow(() -> new BusinessException(ErrorCode.MEMBER_NOT_FOUND));
        return MemberResponse.from(member);
    }
}
```

### 5.2 QuizService
```java
@Service
@RequiredArgsConstructor
@Transactional(readOnly = true)
public class QuizService {

    private final QuizRepository quizRepository;
    private final CategoryRepository categoryRepository;

    public Page<QuizListResponse> findQuizzes(QuizSearchCondition condition, Pageable pageable) {
        Page<Quiz> quizzes = quizRepository.findByCondition(condition, pageable);
        return quizzes.map(QuizListResponse::from);
    }

    public QuizDetailResponse findQuizById(Long quizId) {
        Quiz quiz = quizRepository.findByIdWithQuestions(quizId)
            .orElseThrow(() -> new BusinessException(ErrorCode.QUIZ_NOT_FOUND));

        if (!quiz.getIsPublished()) {
            throw new BusinessException(ErrorCode.QUIZ_NOT_PUBLISHED);
        }

        return QuizDetailResponse.from(quiz);
    }

    @Transactional
    public QuizResponse createQuiz(QuizCreateRequest request, Long memberId) {
        Category category = categoryRepository.findById(request.getCategoryId())
            .orElseThrow(() -> new BusinessException(ErrorCode.CATEGORY_NOT_FOUND));

        Member member = memberRepository.findById(memberId)
            .orElseThrow(() -> new BusinessException(ErrorCode.MEMBER_NOT_FOUND));

        // 퀴즈 생성
        Quiz quiz = Quiz.builder()
            .title(request.getTitle())
            .description(request.getDescription())
            .category(category)
            .difficulty(request.getDifficulty())
            .estimatedTime(request.getEstimatedTime())
            .build();

        // 문제 추가
        request.getQuestions().forEach(questionReq -> {
            Question question = Question.builder()
                .questionText(questionReq.getQuestionText())
                .orderNum(questionReq.getOrderNum())
                .explanation(questionReq.getExplanation())
                .build();

            // 선택지 추가
            questionReq.getOptions().forEach(optionReq -> {
                QuestionOption option = QuestionOption.builder()
                    .optionText(optionReq.getOptionText())
                    .orderNum(optionReq.getOrderNum())
                    .isCorrect(optionReq.getIsCorrect())
                    .build();
                question.addOption(option);
            });

            quiz.addQuestion(question);
        });

        Quiz savedQuiz = quizRepository.save(quiz);
        return QuizResponse.from(savedQuiz);
    }
}
```

### 5.3 QuizAttemptService
```java
@Service
@RequiredArgsConstructor
@Transactional(readOnly = true)
public class QuizAttemptService {

    private final QuizAttemptRepository attemptRepository;
    private final QuizRepository quizRepository;
    private final MemberRepository memberRepository;
    private final QuestionRepository questionRepository;
    private final QuestionOptionRepository optionRepository;

    @Transactional
    public QuizAttemptResponse submitQuiz(QuizSubmitRequest request, Long memberId) {
        // 엔티티 조회
        Member member = memberRepository.findById(memberId)
            .orElseThrow(() -> new BusinessException(ErrorCode.MEMBER_NOT_FOUND));

        Quiz quiz = quizRepository.findByIdWithQuestions(request.getQuizId())
            .orElseThrow(() -> new BusinessException(ErrorCode.QUIZ_NOT_FOUND));

        // 답안 검증 및 채점
        List<AnswerResult> answerResults = new ArrayList<>();
        int score = 0;

        for (AnswerRequest answerReq : request.getAnswers()) {
            Question question = quiz.getQuestions().stream()
                .filter(q -> q.getId().equals(answerReq.getQuestionId()))
                .findFirst()
                .orElseThrow(() -> new BusinessException(ErrorCode.QUESTION_NOT_FOUND));

            QuestionOption selectedOption = optionRepository.findById(answerReq.getSelectedOptionId())
                .orElseThrow(() -> new BusinessException(ErrorCode.OPTION_NOT_FOUND));

            boolean isCorrect = selectedOption.getIsCorrect();
            if (isCorrect) {
                score++;
            }

            answerResults.add(AnswerResult.builder()
                .question(question)
                .selectedOption(selectedOption)
                .isCorrect(isCorrect)
                .build());
        }

        // QuizAttempt 생성
        QuizAttempt attempt = QuizAttempt.builder()
            .member(member)
            .quiz(quiz)
            .score(score)
            .totalQuestions(quiz.getQuestions().size())
            .timeTaken(request.getTimeTaken())
            .completedAt(LocalDateTime.now())
            .build();

        // Answer 생성
        answerResults.forEach(result -> {
            Answer answer = Answer.builder()
                .question(result.getQuestion())
                .selectedOption(result.getSelectedOption())
                .isCorrect(result.getIsCorrect())
                .build();
            attempt.addAnswer(answer);
        });

        QuizAttempt savedAttempt = attemptRepository.save(attempt);
        return QuizAttemptResponse.from(savedAttempt);
    }

    public Page<QuizAttemptHistoryResponse> findMyHistory(Long memberId, Pageable pageable) {
        Page<QuizAttempt> attempts = attemptRepository.findByMemberIdOrderByCompletedAtDesc(
            memberId, pageable
        );
        return attempts.map(QuizAttemptHistoryResponse::from);
    }

    public MemberStatsResponse findMyStats(Long memberId) {
        List<QuizAttempt> attempts = attemptRepository.findByMemberId(memberId);

        // 통계 계산
        int totalAttempts = attempts.size();
        int totalQuestions = attempts.stream()
            .mapToInt(QuizAttempt::getTotalQuestions)
            .sum();
        int totalCorrect = attempts.stream()
            .mapToInt(QuizAttempt::getScore)
            .sum();
        double averageScore = totalQuestions > 0
            ? (double) totalCorrect / totalQuestions * 100
            : 0;
        int totalTimeTaken = attempts.stream()
            .mapToInt(QuizAttempt::getTimeTaken)
            .sum();

        // 카테고리별 통계
        Map<Category, List<QuizAttempt>> categoryMap = attempts.stream()
            .collect(Collectors.groupBy(a -> a.getQuiz().getCategory()));

        List<CategoryStatsResponse> categoryStats = categoryMap.entrySet().stream()
            .map(entry -> {
                Category category = entry.getKey();
                List<QuizAttempt> categoryAttempts = entry.getValue();

                int catTotalQuestions = categoryAttempts.stream()
                    .mapToInt(QuizAttempt::getTotalQuestions)
                    .sum();
                int catCorrect = categoryAttempts.stream()
                    .mapToInt(QuizAttempt::getScore)
                    .sum();

                return CategoryStatsResponse.builder()
                    .category(CategoryResponse.from(category))
                    .attemptCount(categoryAttempts.size())
                    .totalQuestions(catTotalQuestions)
                    .correctAnswers(catCorrect)
                    .percentage(catTotalQuestions > 0
                        ? (double) catCorrect / catTotalQuestions * 100
                        : 0)
                    .build();
            })
            .collect(Collectors.toList());

        return MemberStatsResponse.builder()
            .totalAttempts(totalAttempts)
            .totalQuestions(totalQuestions)
            .totalCorrect(totalCorrect)
            .averageScore(averageScore)
            .totalTimeTaken(totalTimeTaken)
            .categoryStats(categoryStats)
            .build();
    }
}
```

---

## 6. 보안 설정

### 6.1 Spring Security 설정
```java
@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {

    private final JwtAuthenticationFilter jwtAuthenticationFilter;
    private final JwtAuthenticationEntryPoint jwtAuthenticationEntryPoint;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .csrf(csrf -> csrf.disable())
            .cors(cors -> cors.configurationSource(corsConfigurationSource()))
            .sessionManagement(session ->
                session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/auth/**", "/api/categories", "/api/quizzes").permitAll()
                .requestMatchers("/api/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .exceptionHandling(exception ->
                exception.authenticationEntryPoint(jwtAuthenticationEntryPoint))
            .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(Arrays.asList("http://localhost:5173", "https://yourdomain.com"));
        configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE", "PATCH"));
        configuration.setAllowedHeaders(Arrays.asList("*"));
        configuration.setAllowCredentials(true);

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/api/**", configuration);
        return source;
    }
}
```

### 6.2 JWT 유틸리티
```java
@Component
public class JwtUtil {

    @Value("${jwt.secret}")
    private String secret;

    @Value("${jwt.access-token-expiration}")
    private long accessTokenExpiration;

    @Value("${jwt.refresh-token-expiration}")
    private long refreshTokenExpiration;

    public String generateAccessToken(Long memberId, String email, Role role) {
        return Jwts.builder()
            .setSubject(memberId.toString())
            .claim("email", email)
            .claim("role", role.name())
            .setIssuedAt(new Date())
            .setExpiration(new Date(System.currentTimeMillis() + accessTokenExpiration))
            .signWith(SignatureAlgorithm.HS512, secret)
            .compact();
    }

    public String generateRefreshToken(Long memberId) {
        return Jwts.builder()
            .setSubject(memberId.toString())
            .setIssuedAt(new Date())
            .setExpiration(new Date(System.currentTimeMillis() + refreshTokenExpiration))
            .signWith(SignatureAlgorithm.HS512, secret)
            .compact();
    }

    public Claims parseToken(String token) {
        return Jwts.parser()
            .setSigningKey(secret)
            .parseClaimsJws(token)
            .getBody();
    }

    public boolean validateToken(String token) {
        try {
            Jwts.parser().setSigningKey(secret).parseClaimsJws(token);
            return true;
        } catch (JwtException | IllegalArgumentException e) {
            return false;
        }
    }
}
```

---

## 7. 예외 처리

### 7.1 ErrorCode Enum
```java
@Getter
@RequiredArgsConstructor
public enum ErrorCode {
    // Common
    INVALID_INPUT_VALUE(400, "C001", "잘못된 입력값입니다."),
    METHOD_NOT_ALLOWED(405, "C002", "지원하지 않는 HTTP 메서드입니다."),
    INTERNAL_SERVER_ERROR(500, "C003", "서버 오류가 발생했습니다."),

    // Auth
    DUPLICATE_EMAIL(400, "A001", "이미 사용 중인 이메일입니다."),
    INVALID_CREDENTIALS(401, "A002", "이메일 또는 비밀번호가 올바르지 않습니다."),
    UNAUTHORIZED(401, "A003", "인증이 필요합니다."),
    FORBIDDEN(403, "A004", "권한이 없습니다."),
    TOKEN_EXPIRED(401, "A005", "토큰이 만료되었습니다."),
    INVALID_TOKEN(401, "A006", "유효하지 않은 토큰입니다."),

    // Member
    MEMBER_NOT_FOUND(404, "M001", "회원을 찾을 수 없습니다."),

    // Category
    CATEGORY_NOT_FOUND(404, "CT001", "카테고리를 찾을 수 없습니다."),

    // Quiz
    QUIZ_NOT_FOUND(404, "Q001", "퀴즈를 찾을 수 없습니다."),
    QUIZ_NOT_PUBLISHED(400, "Q002", "공개되지 않은 퀴즈입니다."),
    QUESTION_NOT_FOUND(404, "Q003", "문제를 찾을 수 없습니다."),
    OPTION_NOT_FOUND(404, "Q004", "선택지를 찾을 수 없습니다."),

    // QuizAttempt
    ATTEMPT_NOT_FOUND(404, "QA001", "퀴즈 시도 기록을 찾을 수 없습니다."),
    INVALID_ANSWER_COUNT(400, "QA002", "답안 개수가 올바르지 않습니다.");

    private final int status;
    private final String code;
    private final String message;
}
```

### 7.2 GlobalExceptionHandler
```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ErrorResponse> handleBusinessException(BusinessException e) {
        log.error("BusinessException: {}", e.getMessage());
        ErrorResponse response = ErrorResponse.of(e.getErrorCode());
        return ResponseEntity.status(e.getErrorCode().getStatus()).body(response);
    }

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ErrorResponse> handleValidationException(
            MethodArgumentNotValidException e) {
        log.error("ValidationException: {}", e.getMessage());
        ErrorResponse response = ErrorResponse.of(
            ErrorCode.INVALID_INPUT_VALUE,
            e.getBindingResult()
        );
        return ResponseEntity.badRequest().body(response);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleException(Exception e) {
        log.error("Exception: ", e);
        ErrorResponse response = ErrorResponse.of(ErrorCode.INTERNAL_SERVER_ERROR);
        return ResponseEntity.internalServerError().body(response);
    }
}
```

---

## 8. 설정 파일

### 8.1 application.yaml
```yaml
spring:
  application:
    name: quiz

  profiles:
    active: dev

  datasource:
    url: jdbc:mysql://localhost:3306/home_db?useSSL=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8
    username: user
    password: qwer1234!@
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.MySQLDialect
        default_batch_fetch_size: 100
    open-in-view: false

  jackson:
    time-zone: Asia/Seoul
    serialization:
      write-dates-as-timestamps: false

server:
  port: 8081
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true

logging:
  level:
    root: INFO
    com.geonho.quiz: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

jwt:
  secret: ${JWT_SECRET:your-secret-key-change-this-in-production}
  access-token-expiration: 3600000  # 1시간
  refresh-token-expiration: 604800000  # 7일
```

### 8.2 application-dev.yaml
```yaml
spring:
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true

logging:
  level:
    com.geonho.quiz: DEBUG
```

### 8.3 application-prod.yaml
```yaml
spring:
  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false

logging:
  level:
    com.geonho.quiz: INFO
```

---

## 9. 테스트 전략

### 9.1 단위 테스트
```java
@ExtendWith(MockitoExtension.class)
class MemberServiceTest {

    @Mock
    private MemberRepository memberRepository;

    @Mock
    private PasswordEncoder passwordEncoder;

    @InjectMocks
    private MemberService memberService;

    @Test
    @DisplayName("회원가입 성공")
    void signup_success() {
        // given
        SignupRequest request = new SignupRequest("test@example.com", "password123", "테스터");
        when(memberRepository.existsByEmail(anyString())).thenReturn(false);
        when(passwordEncoder.encode(anyString())).thenReturn("encoded");
        when(memberRepository.save(any(Member.class))).thenReturn(
            Member.builder()
                .email(request.getEmail())
                .password("encoded")
                .username(request.getUsername())
                .build()
        );

        // when
        MemberResponse response = memberService.signup(request);

        // then
        assertThat(response.getEmail()).isEqualTo("test@example.com");
        assertThat(response.getUsername()).isEqualTo("테스터");
    }

    @Test
    @DisplayName("중복 이메일로 회원가입 실패")
    void signup_duplicateEmail_fail() {
        // given
        SignupRequest request = new SignupRequest("test@example.com", "password123", "테스터");
        when(memberRepository.existsByEmail(anyString())).thenReturn(true);

        // when & then
        assertThatThrownBy(() -> memberService.signup(request))
            .isInstanceOf(BusinessException.class)
            .hasMessage(ErrorCode.DUPLICATE_EMAIL.getMessage());
    }
}
```

### 9.2 통합 테스트
```java
@SpringBootTest
@AutoConfigureMockMvc
@Transactional
class QuizControllerIntegrationTest {

    @Autowired
    private MockMvc mockMvc;

    @Autowired
    private ObjectMapper objectMapper;

    @Test
    @DisplayName("퀴즈 목록 조회")
    void getQuizzes() throws Exception {
        mockMvc.perform(get("/api/quizzes")
                .param("category", "history")
                .param("difficulty", "EASY")
                .contentType(MediaType.APPLICATION_JSON))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.success").value(true))
            .andExpect(jsonPath("$.data.content").isArray())
            .andDo(print());
    }
}
```

---

## 10. 배포 전략

### 10.1 Docker 설정
```dockerfile
# Dockerfile
FROM eclipse-temurin:17-jre-alpine

WORKDIR /app

COPY build/libs/*.jar app.jar

EXPOSE 8081

ENTRYPOINT ["java", "-jar", "-Dspring.profiles.active=prod", "app.jar"]
```

### 10.2 Docker Compose (전체 스택)
```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: quiz-mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
      MYSQL_DATABASE: home_db
      MYSQL_USER: ${DB_USERNAME}
      MYSQL_PASSWORD: ${DB_PASSWORD}
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - quiz-network
    command:
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
      - --default-authentication-plugin=mysql_native_password

  backend:
    build: ./backend
    container_name: quiz-backend
    environment:
      SPRING_PROFILES_ACTIVE: prod
      DB_URL: jdbc:mysql://mysql:3306/home_db
      DB_USERNAME: ${DB_USERNAME}
      DB_PASSWORD: ${DB_PASSWORD}
      JWT_SECRET: ${JWT_SECRET}
    ports:
      - "8081:8081"
    depends_on:
      - mysql
    networks:
      - quiz-network

volumes:
  mysql_data:

networks:
  quiz-network:
    driver: bridge
```

### 10.3 AWS 배포 (EC2 + RDS)
1. **RDS MySQL 설정**
   - 인스턴스: db.t3.micro
   - 버전: MySQL 8.0
   - 스토리지: 20GB SSD
   - 백업: 자동 백업 활성화

2. **EC2 인스턴스**
   - 인스턴스: t3.small
   - OS: Amazon Linux 2
   - Java 17 설치
   - Nginx 리버스 프록시 설정

3. **CI/CD (GitHub Actions)**
```yaml
name: Deploy to EC2

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Set up JDK 17
        uses: actions/setup-java@v2
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Build with Gradle
        run: ./gradlew build

      - name: Deploy to EC2
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ${{ secrets.EC2_USER }}
          key: ${{ secrets.EC2_PRIVATE_KEY }}
          source: "build/libs/*.jar"
          target: "/home/ec2-user/app"

      - name: Restart Application
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ${{ secrets.EC2_USER }}
          key: ${{ secrets.EC2_PRIVATE_KEY }}
          script: |
            sudo systemctl restart quiz-backend
```

---

## 11. 개발 로드맵

### Phase 1: 기본 기능 구현 (2주)
- [x] 프로젝트 초기 설정
- [ ] 도메인 모델 및 Entity 구현
- [ ] Repository 계층 구현
- [ ] 회원 관리 API (회원가입, 로그인)
- [ ] 카테고리 API
- [ ] 퀴즈 조회 API

### Phase 2: 핵심 기능 구현 (2주)
- [ ] 퀴즈 제출 및 채점 API
- [ ] 사용자 통계 API
- [ ] 퀴즈 히스토리 API
- [ ] 관리자 퀴즈 관리 API
- [ ] 예외 처리 및 검증

### Phase 3: 보안 및 인증 (1주)
- [ ] Spring Security 설정
- [ ] JWT 인증 구현
- [ ] 권한 관리 (USER/ADMIN)
- [ ] 비밀번호 암호화

### Phase 4: 테스트 및 최적화 (1주)
- [ ] 단위 테스트 작성
- [ ] 통합 테스트 작성
- [ ] 성능 최적화 (쿼리 튜닝, 캐싱)
- [ ] API 문서화 (Swagger/SpringDoc)

### Phase 5: 배포 (1주)
- [ ] Docker 이미지 생성
- [ ] AWS 인프라 구성
- [ ] CI/CD 파이프라인 구축
- [ ] 모니터링 설정 (CloudWatch, Prometheus)

---

## 12. 참고 사항

### 12.1 빌드 및 실행
```bash
# 로컬 개발
cd backend/quiz
./gradlew bootRun

# 빌드
./gradlew clean build

# JAR 실행
java -jar build/libs/quiz-0.0.1-SNAPSHOT.jar

# Docker 빌드
docker build -t quiz-backend .

# Docker 실행
docker run -p 8081:8081 quiz-backend
```

### 12.2 데이터베이스 초기화
```bash
# Docker Compose로 MySQL 실행
cd backend/quiz
docker-compose up -d

# 데이터베이스 접속
mysql -h localhost -P 3306 -u user -p
# password: qwer1234!@

# 데이터베이스 선택
use home_db;

# 테이블 확인
show tables;
```

### 12.3 API 문서
- Swagger UI: http://localhost:8081/swagger-ui.html (향후 추가)
- API Docs: http://localhost:8081/v3/api-docs (향후 추가)

---

## 부록: 초기 데이터 스크립트

### data.sql
```sql
-- 카테고리 초기 데이터
INSERT INTO category (name, code, icon, color, display_order, created_at) VALUES
('역사', 'history', 'BookOpen', 'amber', 1, NOW()),
('과학', 'science', 'Beaker', 'blue', 2, NOW()),
('지리', 'geography', 'Globe', 'green', 3, NOW()),
('문화', 'culture', 'Music', 'purple', 4, NOW()),
('엔터테인먼트', 'entertainment', 'Film', 'pink', 5, NOW()),
('기술', 'technology', 'Code', 'indigo', 6, NOW()),
('일반상식', 'general', 'Brain', 'teal', 7, NOW());

-- 관리자 계정 (비밀번호: admin123)
INSERT INTO member (email, password, username, role, status, created_at, updated_at) VALUES
('admin@quiz.com', '$2a$10$XYZ...', '관리자', 'ADMIN', 'ACTIVE', NOW(), NOW());
```

---

## 문서 버전 히스토리

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| v1.0 | 2026-01-08 | Claude | 초기 작성 - 백엔드 API 전체 설계 |

---

**문서 끝**
